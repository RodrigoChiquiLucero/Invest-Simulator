{% extends 'Game/base.html' %}
{% load static from staticfiles %}

{% block body %}

    {# LINKS AND SCRIPTS #}
    {#    //font-awesome#}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    {#   JQUERY #}
    <script src="{% static 'Game/js/jquery.js' %}"></script>

    {#    NICE NUMBER#}
    <link rel="stylesheet"
          href="{% static 'Game/nicenumber/jquery.nice-number.css' %}">
    <script src="{% static 'Game/nicenumber/jquery.nice-number.js' %}"></script>

    {#    PERSONAL#}
    <link rel="stylesheet" href="{% static 'Game/css/assets.css' %}">
    <link rel="stylesheet" href="{% static 'Game/css/transaction-form.css' %}">

    {#    //TOAST#}
    <link rel="stylesheet" href="{% static 'Game/css/toastr.scss' %}">
    <script src="{% static 'Game/js/toastr.js' %}"></script>

    {#    TRANSACTIONS#}
    {% csrf_token %}
    <script src="{% static 'Game/js/ajax.transactions.js' %}"></script>
    <script src="{% static 'Game/js/prepare-transaction.js' %}"></script>
    {# LINKS AND SCRIPTS #}


    <div align="center" class="middle assets inner">

        <div id="quantity-form" class="dinamic short overlay middle">
            <label for="quantity">How much assets do you want
                to purchase?</label>
            <div class="qbox">
                <input id="quantity" class="number-input" type="number" name="quantity middle"
                       value="1" min="1">
            </div>
            <input id="send-quantity" type="submit" value="Send"/>
            <input id="cancel-quantity" type="submit" value="Cancel"/>
        </div>

        <div id="accept-form" class="dinamic large overlay">
            <label>Please confirm your transaction:</label>

            <div class="qbox">
                <p class="attr">Your asset: </p>
                <p id="name" class="value"></p>
                <p class="attr">Asset price: </p>
                <p id="price" class="value"></p>
                <p class="attr">Total transaction value: </p>
                <p id="total" class="value"></p>
            </div>

            <input id="accept-transaction" type="submit" value="Buy"/>
            <input id="cancel-transaction" type="submit" value="Cancel"/>
        </div>

        <div id="trans-status" class="dinamic short overlay">
            <label>Your transaction is being processed</label>

            <div class="qbox">
                <p id="status"></p>
                <i class="fa fa-spinner fa-spin" id="loading"
                   style="font-size:36px;"></i>
            </div>

            <input id="accept-transaction-success" type="submit" value="OK"/>
        </div>

        <div id="assets" class="w3-container w3-animate-zoom assets"
             align="center">
            {% if assets %}
                <table id="dinamic-table">
                    <caption class="title">Available assets in market are:
                    </caption>
                    <tr>
                        <th> Name</th>
                        <th> Type</th>
                        <th> Sell price</th>
                        <th> Buy</th>
                        <th></th>
                        <th></th>
                    </tr>
                    {% for a in assets %}
                        <tr class="dinamic-row">
                            <td id="name">{{ a.name }}</td>
                            <td id="type">{{ a.type }}</td>
                            <td id="sell">$ {{ a.sell }}</td>
                            <td id="buy">$ {{ a.buy }} </td>
                            <td>
                                <a class="action w3-button w3-green w3-round-large "
                                   id="{{ a.name }}" type="{{ a.type }}"
                                   href="#">
                                    <i class="fas fa-dollar-sign"></i> Buy
                                </a></td>
                            <td>
                                <a class="action w3-button w3-green w3-round-large "
                                   href="/game/history/{{ a.name }} ">
                                    <i class="fas fa-history"></i> History
                                </a></td>
                        </tr>
                    {% endfor %}
                </table>
                <script src="{% static 'Game/js/assets-reload.js' %}"></script>
                <script>reload_all();</script>
                <script>
                    prepare_token();
                    prepare_input_nicenumber();
                    prepare_transaction(transaction_types.buy)
                </script>
            {% else %}
                <div class="error_message">
                    <h1> There are no available assets </h1>
                </div>
            {% endif %}
            <ul>
            </ul>
        </div>
    </div>

{% endblock %}
